<%@ page language="java" 
contentType="text/html; charset=UTF-8" 
pageEncoding="UTF-8"%>

<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%-- ì„¸ì…˜ì—ì„œ userNum ê°€ì ¸ì˜¤ê¸° --%>
<c:set var="userNum" value="${userNum}" />
<c:choose>
    <c:when test="${empty shelfNum}">
        <c:set var="shelfNum" value="0" />
    </c:when>
    <c:otherwise>
        <c:set var="shelfNum" value="${shelfNum}" />
    </c:otherwise>
</c:choose>
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="img/pages/icon.png" type="image/png">
        <title>ë¶ë¶ë¶ | ë‚˜ì˜ ì„œì¬</title>
        <!-- Bootstrap Css -->
        <link rel="stylesheet" href="../vender/bootstrap/css/bootstrap.min.css">
        <!-- Icofont Css -->
        <link rel="stylesheet" href="../vender/icofont/icofont.min.css">
        <!-- AOS Css -->
        <link rel="stylesheet" href="../vender/aos/dist/aos.css">
        <!-- Remix Icons -->
        <link rel="stylesheet" href="../vender/remixicon/remixicon.css">
        <!-- Slick Slider Css -->
        <link rel="stylesheet" href="../vender/slick/slick/slick.css">
        <link rel="stylesheet" href="../vender/slick/slick/slick-theme.css">
        <!-- Custom Css -->
        <link rel="stylesheet" href="../css/style.css">
        <!-- Common Css -->
        <link rel="stylesheet" href="../css/common.css">
      <!--sweetalert-->
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.css">
      <!--user-myLibrary CSS-->
      <link rel="stylesheet" href="../css/user-myBookshelf.css">
      
      <!-- ********************JS SECTION************************ -->
      <!-- Bootsrap Bundle Js -->
      <script src="../vender/bootstrap/js/bootstrap.bundle.min.js"></script>
      <!-- Jquery Js -->
      <script src="../vender/jquery/jquery-3.6.4.min.js"></script>
      <!-- AOS Js -->
      <script src="../vender/aos/dist/aos.js"></script>
      <!-- Slick Slider Js -->
      <script src="../vender/slick/slick/slick.min.js"></script>
      <!-- Slick Js -->
      <script src="../js/slick.js"></script>
      <!-- Custom Js -->
      <script src="../js/script.js"></script>
      <!--Sweetalert2 -->
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
   
</head>
<body>
        
<div class="bg-elements elements-top-header position-relative">
    <!-- navbar -->
    <div class="elements-nav">
        <!-- bootom nav -->
        <%@ include file="../header.jsp" %>
   <!-- header -->
   </div>

<!-- ############################################## -->
<!-- tab panes -->
<div class="py-5 bg-light">
    <div class="container bshelf py-4">
        <h1 class="text-center mb-4">ğŸ“š ë‚˜ì˜ ì„œì¬ ğŸ“š</h1>
		<div style="display: flex; justify-content: center; margin-bottom: 4rem;">
		  <h6>ì½ì€ ì±…ì„ í™•ì¸í•˜ê³ , ì½ê³  ìˆëŠ” ì±…ì˜ ì§„í–‰ ìƒí™©ì„ ê¸°ë¡í•˜ë©° ë©”ëª¨ë„ ë‚¨ê¸¸ ìˆ˜ ìˆì–´ìš”.</h6>
		</div>
        <c:choose>
            <c:when test="${not empty sessionScope.userId}">
                <div class="row">
                    <div class="col-12">
                        <nav>
                            <div class="nav nav-tabs d-flex justify-content-center gap-2 nav-tabs-osahan" id="nav-tab" role="tablist">
                                <button class="nav-link active px-lg-4 py-lg-3" id="nav-all-tab" data-bs-toggle="tab" data-bs-target="#nav-all" type="button" role="tab" aria-controls="nav-all" aria-selected="true">ì „ì²´</button>
                                <button class="nav-link px-lg-4 py-lg-3" id="nav-read-tab" data-bs-toggle="tab" data-bs-target="#nav-read" type="button" role="tab" aria-controls="nav-read" aria-selected="false">ì½ì€ ì±…</button>
                                <button class="nav-link px-lg-4 py-lg-3" id="nav-reading-tab" data-bs-toggle="tab" data-bs-target="#nav-reading" type="button" role="tab" aria-controls="nav-reading" aria-selected="false">ì½ê³  ìˆëŠ” ì±…</button>
                                <button class="nav-link px-lg-4 py-lg-3" id="nav-wishlist-tab" data-bs-toggle="tab" data-bs-target="#nav-wishlist" type="button" role="tab" aria-controls="nav-wishlist" aria-selected="false">ì½ê³  ì‹¶ì€ ì±…</button>
                            </div>
                        </nav>
                        
                        <div class="tab-content bg-white p-lg-5 p-4 border-end border-bottom border-start" id="nav-tabContent">
                            <!-- ì „ì²´ íƒ­ íŒ¬ -->
                            <div class="tab-pane fade show active" id="nav-all" role="tabpanel" aria-labelledby="nav-all-tab">
                                <c:choose>
                                    <c:when test="${not empty characterStages}">
                                        <div id="character-stages" class="d-flex justify-content-between"> 
                                            <!--#[0809ìˆ˜ì •] ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•´ í´ë˜ìŠ¤ ì¶”ê°€ ë° ìŠ¤íƒ€ì¼ ë³€ê²½-->
                                            <div class="character-section col-md-6 d-flex justify-content-center align-items-center" style="width: 45%;">
                                                <div class="stage-character p-3 text-center user-level-info">
                                                    <h3>í˜„ì¬ ë‚˜ì˜                                              
                                                        <!-- 'ë‹¨ê³„' í…ìŠ¤íŠ¸ì— íˆ´íŒ ì¶”ê°€ -->
                                                        <span class="custom-tooltip">ë‹¨ê³„
                                                               <span class="tooltiptext">
                                                                   1ë‹¨ê³„: 0-5ê¶Œ<br/>
                                                                   2ë‹¨ê³„: 6-10ê¶Œ<br/>
                                                                   3ë‹¨ê³„: 11-20ê¶Œ <br/>
                                                                   4ë‹¨ê³„: 21-35ê¶Œ<br/>
                                                                   5ë‹¨ê³„: 36-55ê¶Œ<br/>
                                                                   6ë‹¨ê³„: 56-80ê¶Œ<br/>
                                                                   7ë‹¨ê³„: 81-110ê¶Œ<br/>
                                                                   8ë‹¨ê³„: 111-145ê¶Œ<br/>
                                                                   9ë‹¨ê³„: 146ê¶Œ ì´ìƒ
                                                               </span> 
                                                         </span> :
                                                        <span id="characterStage">${characterStages[0].characterStage}</span></h3>
                                                  <!--  <p>ë‹¤ìŒ ë‹¨ê³„ê¹Œì§€ ë‚¨ì€ ì±…: <span id="booksToNextLevel">${booksToNextLevel}</span>ê¶Œ</p>-->
                                                    <div class="progress mb-3">
                                                        <div class="progress-bar" role="progressbar" 
                                                             style="width: ${(readBooksNum / nextLevelBooks) * 100}%;" 
                                                             aria-valuenow="${readBooksNum}" 
                                                             aria-valuemin="0" 
                                                             aria-valuemax="${nextLevelBooks}">
                                                            ${readBooksNum} / ${nextLevelBooks}
                                                        </div>
                                                    </div>
                                                    <img src="${characterStages[0].characterImage}" alt="Character Image" class="character-image img-fluid">
                                                    <p id="characterName"></p>
                                                </div>
                                            </div>
                                          <!--#[0809ìˆ˜ì •] ë¶ì„¹ì…˜ ì¤‘ì•™ ì •ë ¬ ë° ê°„ê²© ì¡°ì •-->
                                          <div class="col-md-6 d-flex justify-content-center align-items-center">
                                             <div class="books-section">
                                               <div class="book-shelves">
                                                 <c:forEach var="book" items="${characterStages}" varStatus="status">
                                                   <c:if test="${status.index % 7 == 0 && status.index != 0}">
                                                     <div class="shelf-divider"></div>
                                                   </c:if>
                                                            <div class="book-spine book-color-${status.index % 4 + 1}">
                                                                <span class="book-title">
                                                                    <c:choose>
                                                                        <c:when test="${fn:length(book.bookTitle) > 10}">
                                                                            ${fn:substring(book.bookTitle, 0, 10)}...
                                                                        </c:when>
                                                                        <c:otherwise>
                                                                            ${book.bookTitle}
                                                                        </c:otherwise>
                                                                    </c:choose>
                                                                </span>
                                                            </div>
                                                        </c:forEach>
                                                    </div>
                                                  </div>
                                              </div>
                                          </div>
                                    </c:when>
                                    <c:otherwise>
                                        <div class="without-data">
                                            <p  class="no-books-message">ì½ì€ ì±…ì´ ì—†ìŠµë‹ˆë‹¤!</p>
                                            <div class="d-flex justify-content-center">
                                                <a href="/" class="btn btn-primary mx-2">ë² ìŠ¤íŠ¸ì…€ëŸ¬ êµ¬ê²½í•˜ëŸ¬ ê°€ê¸°</a>
                                                <a href="/pages/book-categorySearch" class="btn btn-secondary mx-2">ì¹´í…Œê³ ë¦¬ë³„ ì±… êµ¬ê²½í•˜ê¸°</a>
                                                <a href="/pages/book-bookSearchResult" class="btn btn-success mx-2">ì½ê³  ì‹¶ì€ ì±… ë“±ë¡í•˜ê¸°</a>                                           
                                            </div>
                                        </div>
                                    </c:otherwise>
                                </c:choose>
                            </div>
                     
                            <!-- ì½ì€ ì±… íƒ­ íŒ¬ -->
                            <div class="tab-pane fade" id="nav-read" role="tabpanel" aria-labelledby="nav-read-tab">
                                <div class="text-end mt-3">
                                    <div class="btn-group" role="group">
                                        <input type="radio" class="btn-check" name="sort-read" id="startDateRead" autocomplete="off" checked>
                                        <label class="btn btn-outline-secondary btn-sm" for="startDateRead">ì‹œì‘ì¼ìˆœ</label>
                                        <input type="radio" class="btn-check" name="sort-read" id="endDateRead" autocomplete="off">
                                        <label class="btn btn-outline-secondary btn-sm" for="endDateRead">ì¢…ë£Œì¼ìˆœ</label>
                                    </div>
                                </div>
								<div id="read-content">
                                <%@ include file="readBooksTab.jsp" %>
								</div>
                            </div>

                            <!-- ì½ê³  ìˆëŠ” ì±… íƒ­ íŒ¬ -->
                            <div class="tab-pane fade" id="nav-reading" role="tabpanel" aria-labelledby="nav-reading-tab" tabindex="0">
                                <div class="text-end mt-3">
                                    <div class="btn-group" role="group">
                                        <input type="radio" class="btn-check" name="sort-reading" id="startDateReading" autocomplete="off" checked>
                                        <label class="btn btn-outline-secondary btn-sm" for="startDateReading">ì‹œì‘ì¼ìˆœ</label>
                                        <input type="radio" class="btn-check" name="sort-reading" id="readCountReading" autocomplete="off">
                                        <label class="btn btn-outline-secondary btn-sm" for="readCountReading">ë§ì´ ì½ì€ ìˆœ</label>
                                    </div>
                                </div>
								<div id="reading-content">
                                <%@ include file="readingBooksTab.jsp" %>
								</div>
                            </div>

                            <!-- ì½ê³  ì‹¶ì€ ì±… íƒ­ íŒ¬ -->
                            <div class="tab-pane fade" id="nav-wishlist" role="tabpanel" aria-labelledby="nav-wishlist-tab" tabindex="0">
                                <div class="text-end mt-3">
                                    <div class="btn-group" role="group">
                                        <input type="radio" class="btn-check" name="sort-wishlist" id="alphabeticalWishlist" autocomplete="off" checked>
                                        <label class="btn btn-outline-secondary btn-sm" for="alphabeticalWishlist">ê°€ë‚˜ë‹¤ìˆœ</label>
                                        <input type="radio" class="btn-check" name="sort-wishlist" id="addedDateWishlist" autocomplete="off">
                                        <label class="btn btn-outline-secondary btn-sm" for="addedDateWishlist">ì¶”ê°€ëœ ë‚ ì§œìˆœ</label>
                                    </div>
                                </div>
								<div id="wishlist-content">
                                <%@ include file="wishlistBooksTab.jsp" %>
								</div>
                            </div>   
                        
                        </div>
                    </div>
                </div>
            </c:when>
            <c:otherwise>
                <div class="text-center py-5">
                    <h3 class="text-muted">ë¡œê·¸ì¸ í›„ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</h3>
                </div>
                <div id="without-data">
                    <div class="container text-center mt-4">
                        <a href="${pageContext.request.contextPath}/pages/login" class="btn btn-primary btn-lg">ë¡œê·¸ì¸ í•˜ëŸ¬ ê°€ê¸°</a>
                    </div>
                </div>
            </c:otherwise>
        </c:choose>
    </div>
</div>
</div>
<!-- ëª¨ë‹¬ ì°½ HTML -->
<c:if test="${not empty sessionScope.userId}">
   <div class="modal fade" id="memoModal1" tabindex="-1" aria-labelledby="memoModalLabel" aria-hidden="true">
      <div class="modal-dialog">
         <div class="modal-content">
            <div class="modal-header">
               <h5 class="modal-title" id="memoModalLabel">ë©”ëª¨ ì…ë ¥</h5>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">Ã—</span>
               </button>
            </div>
            <div class="modal-body">
               <textarea class="form-control" id="memoContent" rows="5" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-secondary" data-dismiss="modal" style="width: 97px; height: 50px; margin-right: 10px;">ë‹«ê¸°</button>
               <input type="hidden" id="shelfNum" name="shelfNum" value="${shelfNum}">
               <input type="hidden" id="userNum" name="userNum" value="${sessionScope.userNum}">
               <button type="button" class="btn btn-primary" id="saveMemoButton" style=" height: 50px; margin-left: 10px;">ì €ì¥</button>
            </div>
         </div>
      </div>
   </div>
</c:if>
        
                              
         <!-- Nav Sidebar -->
         <%@ include file="../navSidebar.jsp" %>
         <!-- í‘¸í„° í¬í•¨ -->
         <%@ include file="../footer.jsp" %>
         
       <script>
		// ì „ì—­ ë³€ìˆ˜ë¡œ ì±… ëª©ë¡ ë°°ì—´ ì„ ì–¸
		let readBooks, readingBooks, wishBooks;
		console.log("ì „ì—­ ë³€ìˆ˜ í™•ì¸: ", readBooks,readingBooks, wishBooks);
		
       $(document).ready(function() {
         
         // ëª¨ë“  íˆ´íŒ ì´ˆê¸°í™”
                var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl)
                })
               
               
               
           var userNum = $('#userNum').val();
           
           console.log('userNum ë° shelfNum:', userNum);

           // ìºë¦­í„° ì´ë¦„ í‘œì‹œ 
           const characterNames = [
               "ì² í‘¸ë• ì•„ê¸°ì½”ê¸°",
               "ì‚°ì±… ì•„ê¸°ì½”ê¸°",
               "ì´ì¡±ë³´í–‰ ì•„ê¸°ì½”ê¸°",
               "ë…¸ë¦‡ë…¸ë¦‡ ì—‰ë© ì½”ê¸°",
               "ë…¸ë¦‡ë…¸ë¦‡ íœ´ì‹ ì½”ê¸°",
               "ë…¸ë¦‡ë…¸ë¦‡ ì² í‘¸ë• ì½”ê¸°",
               "ëŠ ë¦„ ì‚°ì±… ì½”ê¸°",
               "ëŠ ë¦„ ì§ˆì£¼ ì½”ê¸°",
               "ëŠ ë¦„ ì •ë³µ ì½”ê¸°"
           ];

           const characterStage = document.getElementById('characterStage').textContent;
           const characterNameElement = document.getElementById('characterName');

           // ë¬¸ìì—´ì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œ
           const stageNumber = parseInt(characterStage.replace(/[^0-9]/g, ''));

           if (stageNumber > 0 && stageNumber <= characterNames.length) {
               characterNameElement.textContent = characterNames[stageNumber - 1];
           } else {
               characterNameElement.textContent = "ì•Œ ìˆ˜ ì—†ëŠ” ë‹¨ê³„";
           }

           // ë©”ëª¨ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
           let currentBookTitle;
           let shelfNum;  // #[ìˆ˜ì •] ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë³€ìˆ˜ë¥¼ ì „ì—­ìœ¼ë¡œ ì„¤ì •

           $(document).on('click', '.memo-btn', function() {
               currentBookTitle = $(this).data('book-title');
               shelfNum = $(this).data('shelf-num'); // MODIFIED: ë²„íŠ¼ì—ì„œ shelfNum ê°€ì ¸ì˜¤ê¸°
               $('#memoContent').val(''); // ëª¨ë‹¬ ì—´ ë•Œ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
               console.log("ì„ íƒëœ ì±… ì œëª©:", currentBookTitle);
               console.log("ì„ íƒëœ ì±…ì¥ ë²ˆí˜¸:", shelfNum); // MODIFIED: shelfNum ë¡œê¹…
           });

           // ëª¨ë‹¬ ì €ì¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
           $('#saveMemoButton').on('click', function() {
               var memoContent = $('#memoContent').val().trim(); // ì•ë’¤ ê³µë°± ì œê±°

               if (!currentBookTitle) {
                   console.error('ì±… ì œëª©ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                   alert('ì±…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                   return;
               }

               if (memoContent === '') {
                   alert('ë©”ëª¨ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                   return;
               }

               console.log('User Number:', userNum);
               console.log('Memo Content:', memoContent);
               console.log('Shelf Number:', shelfNum);

               $.ajax({
                   url: '/saveMemo',
                   type: 'POST',
                   contentType: 'application/json',
                   data: JSON.stringify({
                       memoContent: memoContent,
                       userNum: userNum,
                       shelfNum: shelfNum,
                       bookTitle: currentBookTitle
                   }),
                   success: function(response) {
                       console.log('ì„œë²„ ì‘ë‹µ:', response);
                       Swal.fire({ 
                           icon: 'success',
                           title: 'ì €ì¥ ì™„ë£Œ',
                           text: 'ë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.',
                           confirmButtonText: 'í™•ì¸'
                       });
                       $('#memoContent').val('');
                       $('#memoModal1').modal('hide');
                   },
                   error: function(xhr, status, error) {
                       console.error('ì €ì¥ ì‹¤íŒ¨:', error);
                       Swal.fire({ 
                           icon: 'error',
                           title: 'ì €ì¥ ì‹¤íŒ¨',
                           text: 'ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
                           confirmButtonText: 'í™•ì¸'
                       });
                   }
               });
           });

           // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬ 
           $('#memoModal1').on('hide.bs.modal', function (e) {
               if ($('#memoContent').val().trim() !== '') {
                   e.preventDefault(); // ëª¨ë‹¬ ë‹«ê¸° ì¼ì‹œ ì¤‘ì§€
                   Swal.fire({
                       title: 'ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ìˆìŠµë‹ˆë‹¤',
                       text: "ì •ë§ë¡œ ë‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?",
                       icon: 'warning',
                       showCancelButton: true,
                       confirmButtonColor: '#3085d6',
                       cancelButtonColor: '#d33',
                       confirmButtonText: 'ì˜ˆ',
                       cancelButtonText: 'ì•„ë‹ˆì˜¤'
                   }).then((result) => {
                       if (result.isConfirmed) {
                           $('#memoContent').val(''); // í™•ì¸ì„ ëˆ„ë¥´ë©´ í…ìŠ¤íŠ¸ ì…ë ¥ì°½ ë¹„ìš°ê¸°
                           $('#memoModal1').modal('hide'); // ëª¨ë‹¬ ë‹«ê¸°
                       }
                   });
               }
           });

		   // ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
		   $(document).on('click', '.delete-book', function() {
		       console.log("ì‚­ì œ ë²„íŠ¼ í´ë¦­ë¨");
		       var shelfNum = $(this).data('shelf-num');
		       var bookNum = $(this).data('book-num');
		       var $bookItem = $(this).closest('.book-item'); // ì‚­ì œí•  ì±… í•­ëª©

		       console.log("ì‚­ì œí•  ì±…ì˜ shelfNum + bookNum:", shelfNum, bookNum);
		       
		       Swal.fire({
		           title: 'ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
		           icon: 'warning',
		           showCancelButton: true,
		           confirmButtonColor: '#e74c3c',
		           cancelButtonColor: '#3085d6',
		           confirmButtonText: 'ë„¤',
		           cancelButtonText: 'ì•„ë‹ˆì˜¤'
		       }).then((result) => {
		           if (result.isConfirmed) {
		               $.ajax({
		                   url: '/deleteBook',
		                   type: 'POST',
		                   data: { shelfNum: shelfNum, bookNum: bookNum },
						   success: function(result) {
				                 if(result === 'success') {
				                     $bookItem.fadeOut(300, function() {
				                         $(this).remove();
				                         if ($('.book-item').length === 0) {
				                             showNoBookMessage();
				                         }
				                         updateBookArrays(); // ì±… ëª©ë¡ ë°°ì—´ ê°±ì‹ 
				                     });
				                     Swal.fire('ì‚­ì œ ì™„ë£Œ', 'ì±…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
				                 } else {
				                     Swal.fire('ì‚­ì œ ì‹¤íŒ¨', 'ì±… ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
				                 }
				             },
		                   error: function() {
		                       Swal.fire('ì˜¤ë¥˜', 'ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
		                   }
		               });
		           }
		       });
		   });
		   /*
           // ì‚­ì œ ë²„íŠ¼ í´ë¦­ì‹œ
           $(document).on('click', '.delete-book', function() {
               console.log("ì‚­ì œ ë²„íŠ¼ í´ë¦­ë¨");
               var shelfNum = $(this).data('shelf-num');
               var bookNum = $(this).data('book-num');
               console.log("ì‚­ì œí•  ì±…ì˜ shelfNum + bookNum:", shelfNum, bookNum);
               
               Swal.fire({
                   title: 'ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
                   icon: 'warning',
                   showCancelButton: true,
                   confirmButtonColor: '#e74c3c',
                   cancelButtonColor: '#3085d6',
                   confirmButtonText: 'ë„¤',
                   cancelButtonText: 'ì•„ë‹ˆì˜¤'
               }).then((result) => {
                   if (result.isConfirmed) {
                       $.ajax({
                           url: '/deleteBook',
                           type: 'POST',
                           data: { shelfNum: shelfNum, bookNum: bookNum },
                           success: function(result) {
                               if(result === 'success') {
                                   Swal.fire(
                                       'ì‚­ì œ ì™„ë£Œ',
                                       'ì±…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.',
                                       'success'
                                   ).then(() => {
                                       refreshCurrentTab(); // í˜„ì¬ íƒ­ ìƒˆë¡œê³ ì¹¨
                                   });
                               } else {
                                   Swal.fire(
                                       'ì‚­ì œ ì‹¤íŒ¨',
                                       'ì±… ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
                                       'error'
                                   );
                               }
                           },
                           error: function() {
                               Swal.fire(
                                   'ì˜¤ë¥˜',
                                   'ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
                                   'error'
                               );
                           }
                       });
                   }
               });
           });
		   */
		   
		   function showNoBookMessage() {
		       var noBookHtml = `
		           <div class="without-data">
		               <div class="d-flex justify-content-center align-items-center" style="height: 100px;">
		                   <h4 class="no-books-message text-center m-0">ì±…ì´ ì—†ìŠµë‹ˆë‹¤!</h4>
		               </div>
		               <div class="d-flex justify-content-center">
		                   <a href="/" class="btn btn-primary mx-2">ë² ìŠ¤íŠ¸ì…€ëŸ¬ êµ¬ê²½í•˜ëŸ¬ ê°€ê¸°</a>
		                   <a href="/pages/book-categorySearch" class="btn btn-secondary mx-2">ì¹´í…Œê³ ë¦¬ë³„ ì±… êµ¬ê²½í•˜ê¸°</a>
		                   <a href="/pages/book-bookSearchResult" class="btn btn-success mx-2">ì½ê³  ì‹¶ì€ ì±… ë“±ë¡í•˜ê¸°</a>
		               </div>
		           </div>
		       `;

		       // í˜„ì¬ í™œì„±í™”ëœ íƒ­ ì°¾ê¸°
		       var activeTabId = $('.nav-link.active').attr('id');
		       var activeTabContentId = activeTabId.replace('-tab', '');
		       
		       // í™œì„±í™”ëœ íƒ­ì˜ ì±… ëª©ë¡ ì»¨í…Œì´ë„ˆì— ë©”ì‹œì§€ ì‚½ì…
		       $(`#${activeTabContentId} [id$="-list"]`).html(noBookHtml);
		   }
		   
		   // í˜„ì¬ íƒ­ì˜ ë‚´ìš©ë§Œ ìƒˆë¡œê³ ì¹¨í•˜ëŠ” í•¨ìˆ˜
		   function refreshCurrentTab() {
		       var activeTabId = $('.nav-link.active').attr('id');
		       var activeTabContentId = activeTabId.replace('-tab', '');
		       
		       var $activeTab = $('#' + activeTabContentId);
		       
		       // ì •ë ¬ ë²„íŠ¼ì„ í¬í•¨í•œ ì „ì²´ ìƒë‹¨ ì˜ì—­ì„ ì €ì¥
		       var $topSection = $activeTab.children().first().clone();

		       $.ajax({
		           url: '/refreshTab',
		           type: 'GET',
		           data: { tabId: activeTabContentId },
		           success: function(response) {
		               // ìƒˆë¡œìš´ ë‚´ìš©ìœ¼ë¡œ íƒ­ì„ ì—…ë°ì´íŠ¸í•˜ë˜, ìƒë‹¨ ì˜ì—­ì€ ì œì™¸
		               var $newContent = $(response);
		               $newContent.children().first().remove(); // ìƒˆ ì»¨í…ì¸ ì˜ ìƒë‹¨ ì˜ì—­ ì œê±°
		               
		               // ê¸°ì¡´ ìƒë‹¨ ì˜ì—­ê³¼ ìƒˆ ì»¨í…ì¸ ë¥¼ ê²°í•©
		               $activeTab.html('').append($topSection).append($newContent);
		               
		               // ì •ë ¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë‹¤ì‹œ ì¶”ê°€
		               addSortListeners($activeTab.find('input[name^="sort-"]'));
		           },
		           error: function() {
		               console.error('íƒ­ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨');
		           }
		       });
		   }

		   /*
           // í˜„ì¬ íƒ­ì˜ ë‚´ìš©ë§Œ ìƒˆë¡œê³ ì¹¨í•˜ëŠ” í•¨ìˆ˜
           function refreshCurrentTab() {
               var activeTabId = $('.nav-link.active').attr('id');
               var activeTabContentId = activeTabId.replace('-tab', '');
               
               $.ajax({
                   url: '/refreshTab',
                   type: 'GET',
                   data: { tabId: activeTabContentId },
                   success: function(response) {
                       $('#' + activeTabContentId).html(response);
                   },
                   error: function() {
                       console.error('íƒ­ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨');
                   }
               });
           }
		   */

           // ì½ê³  ìˆëŠ” ì±…ì—ì„œ ìˆ˜ì • í´ë¦­ì‹œ
           let currentShelfNum;
           let totalPages;
           let bookNum;
           
           // #[ìˆ˜ì •] ì½ê³  ìˆëŠ” ì±… ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
           $(document).on('click', '.edit-progress', function() { // #[ìˆ˜ì •] ì´ë²¤íŠ¸ ìœ„ì„ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
               currentShelfNum = $(this).data('shelf-num');
               totalPages = $(this).data('book-page');
               bookNum = $(this).data('book-num');
               let $bookItem = $(this).closest('.book-item');
               let startDate = $bookItem.find('.start-date').text();
               let currentReadPages = $bookItem.find('.book-progress').text().match(/(\d+)\/(\d+)/)[1];
               
               console.log('ìˆ˜ì • ë²„íŠ¼ í´ë¦­:', { shelfNum: currentShelfNum, totalPages, bookNum, startDate, currentReadPages });

               $('#editStartDate').val(startDate);
               $('#editPageInput').val(currentReadPages);
               $('#editProgressModal').modal('show');
           });

         // ##[ìˆ˜ì •] ì €ì¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
         $('#saveProgress').on('click', function(e) {
             e.preventDefault();
             let newStartDate = $('#editStartDate').val();
             let newReadPages = parseInt($('#editPageInput').val());
             let isCompleted = newReadPages === totalPages;
             
             console.log('ì €ì¥ ë²„íŠ¼ í´ë¦­:', { newStartDate, newReadPages, totalPages, currentShelfNum });

             if (newReadPages > totalPages) {
                 Swal.fire({
                     icon: 'error',
                     title: 'ì˜¤ë¥˜',
                     text: 'ì´ í˜ì´ì§€ ìˆ˜ë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                 });
                 return;
             }
             
             // ##[ìˆ˜ì •] ë°ì´í„° ê°ì²´ ìƒì„±
             let data = {
                 shelfNum: currentShelfNum,
                 readPages: newReadPages,
                 startDate: newStartDate,
                 isCompleted: isCompleted,
				 totalPages: totalPages  // totalPages ì¶”ê°€
             };
             
             // ##[ìˆ˜ì •] ì±…ì„ ì™„ë…í•œ ê²½ìš°ì—ë§Œ ë³„ì  ì…ë ¥ ëª¨ë‹¬ í‘œì‹œ ë° ë°ì´í„°ì— ì¶”ê°€
             if (isCompleted) {
                 Swal.fire({
                     title: 'ì±…ì„ ë‹¤ ì½ìœ¼ì…¨êµ°ìš”!',
                     text: 'ì´ ì±…ì— ëŒ€í•œ ë³„ì ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.',
                     input: 'range',
                     inputAttributes: {
                         min: 1,
                         max: 5,
                         step: 1
                     },
                     inputValue: 3,
                     showCancelButton: true,
                     confirmButtonText: 'í™•ì¸',
                     cancelButtonText: 'ì·¨ì†Œ'
                 }).then((result) => {
                     if (result.isConfirmed) {
                         data.rating = result.value;
                         saveBookProgress(data);
                     }
                 });
             } else {
                 saveBookProgress(data);
             }
         });
		 
	

		 /*
         // ##[ìˆ˜ì •] ì±… ì§„í–‰ ìƒíƒœ ì €ì¥ í•¨ìˆ˜
         function saveBookProgress(data) {
             $.ajax({
                 url: '/updateBooks',
                 type: 'POST',
                 contentType: 'application/json',
                 data: JSON.stringify(data),
                 success: function(response) {
                     if(response.status === "success") {
                         Swal.fire({
                             icon: 'success',
                             title: 'ì €ì¥ ì™„ë£Œ',
                             text: response.message
                         });
                         $('#editProgressModal').modal('hide');
                         refreshAllTabs(); // ëª¨ë“  íƒ­ ìƒˆë¡œê³ ì¹¨
                     } else {
                         Swal.fire({
                             icon: 'error',
                             title: 'ì €ì¥ ì‹¤íŒ¨',
                             text: response.message
                         });
                     }
                 },
                 error: function(xhr, status, error) {
                     Swal.fire({
                         icon: 'error',
                         title: 'ì˜¤ë¥˜',
                         text: 'ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
                     });
                     console.error('Error:', error);
                 }
             });
         }
		 */
         
         function refreshAllTabs() {
             refreshTab('nav-read');  // ì½ì€ ì±… íƒ­
             refreshTab('nav-reading');  // ì½ê³  ìˆëŠ” ì±… íƒ­
             refreshTab('nav-wishlist');  // ì½ê³  ì‹¶ì€ ì±… íƒ­
         }
		 

		 // ì±… ëª©ë¡ ë°°ì—´ì„ ê°±ì‹ í•˜ëŠ” í•¨ìˆ˜
		 function updateBookArrays() {
		     readBooks = Array.from($('#nav-read .read-books.book-item'));
		     readingBooks = Array.from($('#nav-reading .reading-books.book-item'));
		     wishBooks = Array.from($('#nav-wishlist .wish-books.book-item'));
		     console.log("Book arrays updated:", { readBooks, readingBooks, wishBooks });
		 }
         
         /* function refreshTab(tabId) {
             $.ajax({
                 url: '/refreshTab',
                 type: 'GET',
                 data: { tabId: tabId },
                 success: function(response) {
                     $('#' + tabId).html(response);
                 },
                 error: function() {
                     console.error(tabId + ' íƒ­ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨');
                 }
             });
         } */
		 // íƒ­ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜ ìˆ˜ì •
		    function refreshTab(tabId) {
		        $.ajax({
		            url: '/refreshTab',
		            type: 'GET',
		            data: { tabId: tabId },
		            success: function(response) {
		                let $tab = $(`#${tabId}`);
		                // ì •ë ¬ ë²„íŠ¼ ë³´ì¡´
		                let sortButtons = $tab.find('.btn-group').detach();
		                
		                // íƒ­ ë‚´ìš© ì—…ë°ì´íŠ¸
		                $tab.html(response);
		                
		                // ì •ë ¬ ë²„íŠ¼ ë‹¤ì‹œ ì¶”ê°€
		                $tab.prepend(sortButtons);
		                
		                // ì±… ëª©ë¡ ë°°ì—´ ê°±ì‹ 
		                updateBookArrays();
		                
		                // ì •ë ¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë‹¤ì‹œ ì¶”ê°€
		                addSortListeners($tab.find('input[name^="sort-"]'));
		            },
		            error: function(xhr, status, error) {
		                console.error(`${tabId} íƒ­ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:`, error);
		            }
		        });
		    }
			
			function saveBookProgress(data) {
			    $.ajax({
			        url: '/updateBooks',
			        type: 'POST',
			        contentType: 'application/json',
			        data: JSON.stringify(data),
			        success: function(response) {
			            if(response.status === "success") {
			                // ëª¨ë‹¬ì„ ë‹«ê¸° ì „ì— UIë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
			                updateBookItem(response.updatedBook);
			                
			                // ì±… ëª©ë¡ ë°°ì—´ ê°±ì‹ 
			                updateBookArrays();

			                // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
			                Swal.fire({
			                    icon: 'success',
			                    title: 'ì €ì¥ ì™„ë£Œ',
			                    text: response.message
			                }).then(() => {
			                    // ì•Œë¦¼ì°½ì´ ë‹«íŒ í›„ì— ëª¨ë‹¬ì„ ë‹«ìŠµë‹ˆë‹¤.
			                    $('#editProgressModal').modal('hide');
			                });
			            } else {
			                Swal.fire({
			                    icon: 'error',
			                    title: 'ì €ì¥ ì‹¤íŒ¨',
			                    text: response.message
			                });
			            }
			        },
			        error: function(xhr, status, error) {
			            Swal.fire({
			                icon: 'error',
			                title: 'ì˜¤ë¥˜',
			                text: 'ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
			            });
			            console.error('Error:', error);
			        }
			    });
			}

			function updateBookItem(updatedBook) {
			    // ì—…ë°ì´íŠ¸í•  ì±… í•­ëª©ì„ ì°¾ìŠµë‹ˆë‹¤.
			    let $bookItem = $(`.reading-books[data-shelf-num="${updatedBook.shelfNum}"]`);
			    
			    if ($bookItem.length > 0) {
			        // ì§„í–‰ë¥ ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
			        let progress = (updatedBook.readPages / updatedBook.bookPage) * 100;
			        let formattedProgress = progress.toFixed(2);

			        // ì‹œì‘ì¼ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
			        $bookItem.find('.start-date').text(updatedBook.startDate);
			        
			        // ì§„í–‰ë°”ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
			        $bookItem.find('.progress-bar')
			            .css('width', `${progress}%`)
			            .attr('aria-valuenow', progress);
			        
			        // ì§„í–‰ ìƒíƒœ í…ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
			        $bookItem.find('.book-progress').html(
			            `${formattedProgress}% (${updatedBook.readPages}/${updatedBook.bookPage} í˜ì´ì§€)`
			        );

			        console.log('Book item updated:', updatedBook.shelfNum);
			    } else {
			        console.error('Book item not found:', updatedBook.shelfNum);
			        // ìš”ì†Œê°€ ì—†ìœ¼ë©´ ìƒˆë¡œ ì¶”ê°€í•©ë‹ˆë‹¤.
			        addNewBookItem(updatedBook);
			    }
			}

			function addNewBookItem(book) {
			    // ìƒˆë¡œìš´ ì±… í•­ëª©ì„ ìƒì„±í•˜ëŠ” HTML í…œí”Œë¦¿
			    let newBookHTML = `
			        <div class="reading-books book-item d-flex align-items-start mb-4" data-shelf-num="${book.shelfNum}" data-book-num="${book.bookNum}">
			            <img src="${book.bname || '../img/noImage.jpg'}" alt="ì±… í‘œì§€" class="book-cover me-3" style="width: 100px; height: 150px;">
			            <div class="book-info flex-grow-1">
			                <h5 class="book-title">${book.bookTitle}</h5>
			                <p class="book-author mb-1">${book.writer}</p>
			                <p class="book-dates book-start-date mb-1">ì‹œì‘ì¼ <span class="start-date">${book.startDate}</span></p>
			                <div class="progress mb-2" style="height: 10px;">
			                    <div class="progress-bar bg-success" role="progressbar" style="width: ${(book.readPages / book.bookPage) * 100}%" 
			                         aria-valuenow="${(book.readPages / book.bookPage) * 100}" aria-valuemin="0" aria-valuemax="100"></div>
			                </div>
			                <p class="book-progress mb-0">${((book.readPages / book.bookPage) * 100).toFixed(2)}% (${book.readPages}/${book.bookPage} í˜ì´ì§€)</p>
			            </div>
			            <div class="book-actions">
			                <button class="btn btn-sm memo-btn" data-toggle="modal" data-target="#memoModal1" 
			                        data-book-title="${book.bookTitle}" data-shelf-num="${book.shelfNum}">ë©”ëª¨</button>
			                <button class="btn btn-sm delete-book" data-shelf-num="${book.shelfNum}">ì‚­ì œ</button>
			                <button class="btn btn-sm edit-progress" data-shelf-num="${book.shelfNum}" 
			                        data-book-page="${book.bookPage}" data-book-num="${book.bookNum}">ìˆ˜ì •</button>
			            </div>
			        </div>
			    `;
			    
			    // ìƒˆë¡œìš´ ì±… í•­ëª©ì„ ì½ê³  ìˆëŠ” ì±… ëª©ë¡ì— ì¶”ê°€
			    $('#reading-list').append(newBookHTML);
			}
			/*
		//0813[1]
		 function updateBookItem(shelfNum, startDate, readPages, totalPages) {
		     if (shelfNum != null && startDate != null && !isNaN(readPages) && !isNaN(totalPages) && totalPages > 0) {
		         let progress = (readPages / totalPages) * 100;
		         let formattedProgress = progress.toFixed(2);

		         let $bookItem = $(`.reading-books[data-shelf-num="${shelfNum}"]`);
		         if ($bookItem.length > 0) {
		             $bookItem.find('.start-date').text(startDate);
		             $bookItem.find('.progress-bar')
		                 .css('width', `${progress}%`)
		                 .attr('aria-valuenow', progress);
		             $bookItem.find('.book-progress').html(
		                 `${formattedProgress}% (${readPages}/${totalPages} í˜ì´ì§€)`
		             );
		             console.log('Book item updated:', shelfNum);
		         } else {
		             console.log('Book item not found:', shelfNum);
		         }
		     } else {
		         console.log('Invalid input for updateBookItem:', { shelfNum, startDate, readPages, totalPages });
		     }
		 }
		 */
		 /*
         function updateBookItem(shelfNum, startDate, readPages, totalPages) {
             if (shelfNum != null && startDate != null && !isNaN(readPages) && !isNaN(totalPages) && totalPages > 0) {
                 let progress = (readPages / totalPages) * 100;
               let formattedProgress = progress.toFixed(2); // ë‘ ìë¦¬ ì†Œìˆ˜ì ê¹Œì§€ í¬ë§·
               console.log('ì†Œìˆ˜'+formattedProgress)

                 let $bookItem = $(`[data-shelf-num="${shelfNum}"]`).closest('.book-item');

                 console.log('ì±… ì•„ì´í…œ ì—…ë°ì´íŠ¸:', { shelfNum, startDate, readPages, totalPages, progress });

                 $bookItem.find('.start-date').text(startDate);
                 $bookItem.find('.progress-bar')
                     .css('width', `${progress}%`)
                     .attr('aria-valuenow', progress);
                 $bookItem.find('.book-progress').html(
                     `${formattedProgress}% (${readPages}/${totalPages} í˜ì´ì§€)`
                 );

                 console.log('ì—…ë°ì´íŠ¸ëœ HTML:', $bookItem.html());
             } else {
                 console.log('ìœ íš¨í•˜ì§€ ì•Šì€ ì…ë ¥ ê°’:', { shelfNum, startDate, readPages, totalPages });
             }
         } // end of updateBookItem
		 */
		 
		 
         // *************************************
         // [0809 ì¶”ê°€] ì •ë ¬ ë²„íŠ¼
         
         // ì •ë ¬ ë²„íŠ¼ ìš”ì†Œ
         const sortButtonsRead = document.querySelectorAll('input[name="sort-read"]'); // ì½ì€ ì±…
         const sortButtonsReading = document.querySelectorAll('input[name="sort-reading"]'); // ì½ê³  ìˆëŠ” ì±…
         const sortButtonsWish = document.querySelectorAll('input[name="sort-wishlist"]'); // ìœ„ì‹œë¦¬ìŠ¤íŠ¸
         // ì±… ì„¤ëª… div
         const readBookNav = document.getElementById('nav-read'); // ì½ì€ ì±… div
         const readingBookNav = document.getElementById('nav-reading'); // ì½ê³  ìˆëŠ” ì±… div
         const wishListNav = document.getElementById('nav-wishlist'); // ìœ„ì‹œë¦¬ìŠ¤íŠ¸ div
         
         console.log("readingBookNav : ", readingBookNav);

         // ì±… í•­ëª©ì„ ë°°ì—´ë¡œ ë³€í™˜
         let readBooks = Array.from(readBookNav.getElementsByClassName('read-books')); // ì½ì€ ì±… í•­ëª©
         let readingBooks = Array.from(readingBookNav.getElementsByClassName('reading-books')); // ì½ê³  ìˆëŠ” ì±… í•­ëª©
         let wishBooks = Array.from(wishListNav.getElementsByClassName('wish-books')); // ìœ„ì‹œë¦¬ìŠ¤íŠ¸ í•­ëª©

		 // ì •ë ¬ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ í•¨ìˆ˜
		    function addSortListeners() {
		        $('input[name^="sort-"]').off('click').on('click', function() {
		            console.log("Sort button clicked:", this.id);
		            sortEntries(this.id);
		        });
		    }
		 /*
         // ì •ë ¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ë¦¬ìŠ¤ë„ˆ 
         function addSortListeners(buttons) {
             buttons.forEach(button => {
                 button.addEventListener('click', function() {
                     console.log("Sorting by:", this.id);
                     sortEntries(this.id);
                 });
             });
         }
		 */

         addSortListeners(sortButtonsRead);
         addSortListeners(sortButtonsReading);
         addSortListeners(sortButtonsWish);

         // ë‚ ì§œ ë¬¸ìì—´ì„ Date ê°ì²´ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ (ì—°-ì›”-ì¼ë§Œ ê³ ë ¤)
         function parseDate(dateString) {
             const [year, month, day] = dateString.split('-').map(Number);
             return new Date(year, month - 1, day);
         }

         // ì§„í–‰ë¥  í˜•ë³€í™˜ í•¨ìˆ˜ 
         function extractProgress(element) {
             const progressText = element.querySelector('.book-progress')?.textContent.trim();
             if (progressText) {
                 const match = progressText.match(/(\d+(\.\d+)?)%/);
                 return match ? parseFloat(match[1]) : 0;
             }
             return 0;
         }

		 /*
         function sortEntries(order) {
             console.log("Sorting entries...");
             let books;
             let container;

             // [ ì½ì€ ì±… ]
             if (order === 'startDateRead' || order === 'endDateRead') {
                 console.log("Read sortEntries");
                 books = readBooks;
                 container = readBookNav.querySelector('#read-list');
             }
             // [ ì½ê³  ìˆëŠ” ì±… ]
             else if (order === 'startDateReading' || order === 'readCountReading') {
                 console.log("Reading sortEntries");
                 books = readingBooks;
                 container = readingBookNav.querySelector('#reading-list');
             }
             // [ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ]
             else if (order === 'alphabeticalWishlist' || order === 'addedDateWishlist') {
                 console.log("Wishlist sortEntries");
                 books = wishBooks;
                 container = wishListNav.querySelector('#wishlist-list');
             }
*/
		// ì •ë ¬ í•¨ìˆ˜ ìˆ˜ì •
		function sortEntries(order) {
		       console.log("Sorting entries...");
		       let books;
		       let container;

		       updateBookArrays(); // ì •ë ¬ ì „ ë°°ì—´ ì—…ë°ì´íŠ¸

		       // í˜„ì¬ í™œì„±í™”ëœ íƒ­ì— ë”°ë¼ ì ì ˆí•œ ì±… ëª©ë¡ê³¼ ì»¨í…Œì´ë„ˆ ì„ íƒ
		       if ($('#nav-read').hasClass('active')) {
		           books = readBooks;
		           container = $('#read-list');
		       } else if ($('#nav-reading').hasClass('active')) {
		           books = readingBooks;
		           container = $('#reading-list');
		       } else if ($('#nav-wishlist').hasClass('active')) {
		           books = wishBooks;
		           container = $('#wishlist-list');
		       }

		       console.log("Current active tab:", $('.nav-link.active').attr('id'));
		       console.log("Sorting books:", books);

		       if (!books || books.length === 0) {
		           console.log("No books to sort");
		           return;
		       }

			 
             books.sort((a, b) => {
               // [ ì‹œì‘ì¼ìˆœ ]
                 if (order === 'startDateRead' || order === 'startDateReading') {
                     const dateA = parseDate(a.querySelector('.book-dates .start-date').textContent.trim());
                     const dateB = parseDate(b.querySelector('.book-dates .start-date').textContent.trim());
                  // ì˜¤ë¦„ì°¨ìˆœ
                     return dateA - dateB;
                 }
               // [ ì¢…ë£Œì¼ìˆœ ]
                 else if (order === 'endDateRead') {
                     const dateA = parseDate(a.querySelector('.book-dates .end-date').textContent.trim());
                     const dateB = parseDate(b.querySelector('.book-dates .end-date').textContent.trim());
                  // ë‚´ë¦¼ì°¨ìˆœ 
                     return dateB - dateA;
                 }
               // [ ë§ì´ ì½ì€ ìˆœ ]
                 else if (order === 'readCountReading') {
                     const progressA = extractProgress(a);
                     const progressB = extractProgress(b);
                     console.log("progressA : ", progressA);
                     console.log("progressB : ", progressB);
                     return progressB - progressA; // ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ë§ì´ ì½ì€ ìˆœ)
                 }
                 // [ ê°€ë‚˜ë‹¤ ìˆœ ]
               else if (order === 'alphabeticalWishlist'){
                  const titleA = a.querySelector('.book-title').textContent.trim();
                  const titleB = b.querySelector('.book-title').textContent.trim();
                  return titleA.localeCompare(titleB, 'ko-KR');  // í•œê¸€ ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬
               }
               // [ ì¶”ê°€ëœ ë‚ ì§œ ìˆœ ] 
               else if (order === 'addedDateWishlist'){
                   const dateA = parseDate(a.querySelector('.book-added-date .added-date').textContent.trim());
                   const dateB = parseDate(b.querySelector('.book-added-date .added-date').textContent.trim());
                   // ë‚´ë¦¼ì°¨ìˆœ
                   return dateB - dateA;
               }
             });

            // í™”ë©´ì— ë¶™ì´ê¸° 
             //container.innerHTML = '';
             //books.forEach(entry => container.appendChild(entry));
			 
			 // ì •ë ¬ëœ ëª©ë¡ì„ í™”ë©´ì— ë‹¤ì‹œ í‘œì‹œ
			 container.empty().append(books);
             console.log("Sorting completed");
         }
		 
		 updateBookArrays();

		    // íƒ­ ë³€ê²½ ì´ë²¤íŠ¸
		    $('.nav-link').on('shown.bs.tab', function (e) {
		        console.log("Tab changed:", e.target.id);
		        updateBookArrays();
		    });
		 
			// ì´ˆê¸° ì„¤ì •
			   updateBookArrays();
			   addSortListeners();
         
         
      });
   </script>
         
      
</body>
</html>